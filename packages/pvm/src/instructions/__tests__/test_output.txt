bun test v1.2.21 (7c45ed97)

riscv-programs.test.ts:
Found 99 test vector files
Loaded test vector: riscv_rv64ui_sraiw.json
Loaded test vector: riscv_rv64uzbb_andn.json
Loaded test vector: riscv_rv64ui_subw.json
Loaded test vector: riscv_rv64ui_ori.json
Loaded test vector: riscv_rv64ui_bltu.json
Loaded test vector: riscv_rv64uzbb_sext_b.json
Loaded test vector: riscv_rv64ua_amomax_d.json
Loaded test vector: riscv_rv64um_mulw.json
Loaded test vector: riscv_rv64um_mul.json
Loaded test vector: riscv_rv64ui_lh.json
Loaded test vector: riscv_rv64um_mulhu.json
Loaded test vector: riscv_rv64ui_addi.json
Loaded test vector: riscv_rv64uzbb_ctzw.json
Loaded test vector: riscv_rv64ui_sltiu.json
Loaded test vector: riscv_rv64uzbb_minu.json
Loaded test vector: riscv_rv64ui_ld.json
Loaded test vector: riscv_rv64uzbb_clzw.json
Loaded test vector: riscv_rv64ui_srlw.json
Loaded test vector: riscv_rv64ui_bgeu.json
Loaded test vector: riscv_rv64ua_amomin_d.json
Loaded test vector: riscv_rv64um_div.json
Loaded test vector: riscv_rv64uzbb_roriw.json
Loaded test vector: riscv_rv64um_divuw.json
Loaded test vector: riscv_rv64ui_srli.json
Loaded test vector: riscv_rv64ui_xor.json
Loaded test vector: riscv_rv64ui_sb.json
Loaded test vector: riscv_rv64ui_slti.json
Loaded test vector: riscv_rv64um_rem.json
Loaded test vector: riscv_rv64ua_amomaxu_d.json
Loaded test vector: riscv_rv64ui_lhu.json
Loaded test vector: riscv_rv64ui_addw.json
Loaded test vector: riscv_rv64um_remw.json
Loaded test vector: riscv_rv64ui_beq.json
Loaded test vector: riscv_rv64ui_sw.json
Loaded test vector: riscv_rv64ui_lwu.json
Loaded test vector: riscv_rv64ua_amomin_w.json
Loaded test vector: riscv_rv64uzbb_sext_h.json
Loaded test vector: riscv_rv64um_mulh.json
Loaded test vector: riscv_rv64ui_lw.json
Loaded test vector: riscv_rv64ui_sllw.json
Loaded test vector: riscv_rv64ui_lb.json
Loaded test vector: riscv_rv64um_mulhsu.json
Loaded test vector: riscv_rv64ui_blt.json
Loaded test vector: riscv_rv64ui_bge.json
Loaded test vector: riscv_rv64ui_sub.json
Loaded test vector: riscv_rv64ui_and.json
Loaded test vector: riscv_rv64ui_andi.json
Loaded test vector: riscv_rv64ua_amomax_w.json
Loaded test vector: riscv_rv64ui_lbu.json
Loaded test vector: riscv_rv64ui_srliw.json
Loaded test vector: riscv_rv64ua_amoxor_w.json
Loaded test vector: riscv_rv64uc_rvc.json
Loaded test vector: riscv_rv64ui_ma_data.json
Loaded test vector: riscv_rv64ua_amoand_d.json
Loaded test vector: riscv_rv64ui_or.json
Loaded test vector: riscv_rv64ui_jal.json
Loaded test vector: riscv_rv64uzbb_clz.json
Loaded test vector: riscv_rv64um_remu.json
Loaded test vector: riscv_rv64ua_amoor_w.json
Loaded test vector: riscv_rv64ui_slt.json
Loaded test vector: riscv_rv64ua_amoadd_w.json
Loaded test vector: riscv_rv64ui_sraw.json
Loaded test vector: riscv_rv64um_remuw.json
Loaded test vector: riscv_rv64uzbb_rorw.json
Loaded test vector: riscv_rv64uzbb_orc_b.json
Loaded test vector: riscv_rv64ui_add.json
Loaded test vector: riscv_rv64ui_xori.json
Loaded test vector: riscv_rv64ua_amominu_d.json
Loaded test vector: riscv_rv64ui_sll.json
Loaded test vector: riscv_rv64ua_amoswap_w.json
Loaded test vector: riscv_rv64uzbb_ror.json
Loaded test vector: riscv_rv64ui_jalr.json
Loaded test vector: riscv_rv64ui_lui.json
Loaded test vector: riscv_rv64uzbb_xnor.json
Loaded test vector: riscv_rv64uzbb_rol.json
Loaded test vector: riscv_rv64um_divu.json
Loaded test vector: riscv_rv64uzbb_ctz.json
Loaded test vector: riscv_rv64ua_amoadd_d.json
Loaded test vector: riscv_rv64uzbb_rev8.json
Loaded test vector: riscv_rv64ua_amoor_d.json
Loaded test vector: riscv_rv64uzbb_zext_h.json
Loaded test vector: riscv_rv64uzbb_cpop.json
Loaded test vector: riscv_rv64uzbb_orn.json
Loaded test vector: riscv_rv64ua_amoand_w.json
Loaded test vector: riscv_rv64uzbb_max.json
Loaded test vector: riscv_rv64ua_amoxor_d.json
Loaded test vector: riscv_rv64ui_srl.json
Loaded test vector: riscv_rv64ui_bne.json
Loaded test vector: riscv_rv64uzbb_min.json
Loaded test vector: riscv_rv64ui_srai.json
Loaded test vector: riscv_rv64ua_amoswap_d.json
Loaded test vector: riscv_rv64uzbb_rori.json
Loaded test vector: riscv_rv64ui_sltu.json
Loaded test vector: riscv_rv64ui_sra.json
Loaded test vector: riscv_rv64ua_amominu_w.json
Loaded test vector: riscv_rv64ui_simple.json
Loaded test vector: riscv_rv64ui_addiw.json
Loaded test vector: riscv_rv64uzbb_rolw.json
Loaded test vector: riscv_rv64uzbb_maxu.json
Successfully loaded 99 test vectors
[2025-10-25T13:51:29.447Z] [INFO] instructions: {
  instructions: [
    "LOAD_IMM (51) operands: 0, 0, 0, 1 pc: 0", "ADD_IMM_32 (131) operands: 0, 255 pc: 5",
    "SHLO_L_IMM_64 (151) operands: 0, 16 pc: 8", "JUMP_IND (50) operands: 0 pc: 11", "LOAD_IMM (51) operands: 5, 2 pc: 13",
    "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 16", "SHAR_R_IMM_32 (140) operands: 171 pc: 22",
    "LOAD_IMM (51) operands: 4, 0, 0, 0, 128 pc: 24", "BRANCH_NE (171) operands: 75, 27, 3 pc: 30",
    "LOAD_IMM (51) operands: 5, 3 pc: 34", "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 37",
    "SHAR_R_IMM_32 (140) operands: 171, 1 pc: 43", "LOAD_IMM (51) operands: 4, 0, 0, 0, 192 pc: 46",
    "BRANCH_NE (171) operands: 75, 5, 3 pc: 52", "LOAD_IMM (51) operands: 5, 4 pc: 56",
    "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 59", "SHAR_R_IMM_32 (140) operands: 171, 7 pc: 65",
    "LOAD_IMM (51) operands: 4, 0, 0, 0, 255 pc: 68", "BRANCH_NE (171) operands: 75, 239, 2 pc: 74",
    "LOAD_IMM (51) operands: 5, 5 pc: 78", "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 81",
    "SHAR_R_IMM_32 (140) operands: 171, 14 pc: 87", "LOAD_IMM (51) operands: 4, 0, 0, 254 pc: 90",
    "BRANCH_NE (171) operands: 75, 218, 2 pc: 95", "LOAD_IMM (51) operands: 5, 6 pc: 99",
    "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 102", "ADD_IMM_32 (131) operands: 170, 1 pc: 108",
    "SHAR_R_IMM_32 (140) operands: 171, 31 pc: 111", "LOAD_IMM (51) operands: 4, 255 pc: 114",
    "BRANCH_NE (171) operands: 75, 196, 2 pc: 117", "LOAD_IMM (51) operands: 5, 7 pc: 121",
    "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 124", "ADD_IMM_32 (131) operands: 170, 255 pc: 130",
    "SHAR_R_IMM_32 (140) operands: 171 pc: 133", "LOAD_IMM (51) operands: 4, 0, 0, 0, 128 pc: 135",
    "ADD_IMM_32 (131) operands: 68, 255 pc: 141", "BRANCH_NE (171) operands: 75, 169, 2 pc: 144",
    "LOAD_IMM (51) operands: 5, 8 pc: 148", "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 151",
    "ADD_IMM_32 (131) operands: 170, 255 pc: 157", "SHAR_R_IMM_32 (140) operands: 171, 1 pc: 160",
    "LOAD_IMM (51) operands: 4, 0, 0, 0, 64 pc: 163", "ADD_IMM_32 (131) operands: 68, 255 pc: 169",
    "BRANCH_NE (171) operands: 75, 141, 2 pc: 172", "LOAD_IMM (51) operands: 5, 9 pc: 176",
    "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 179", "ADD_IMM_32 (131) operands: 170, 255 pc: 185",
    "SHAR_R_IMM_32 (140) operands: 171, 7 pc: 188", "LOAD_IMM (51) operands: 4, 0, 0, 0, 1 pc: 191",
    "ADD_IMM_32 (131) operands: 68, 255 pc: 197", "BRANCH_NE (171) operands: 75, 113, 2 pc: 200",
    "LOAD_IMM (51) operands: 5, 10 pc: 204", "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 207",
    "ADD_IMM_32 (131) operands: 170, 255 pc: 213", "SHAR_R_IMM_32 (140) operands: 171, 14 pc: 216",
    "LOAD_IMM (51) operands: 4, 0, 0, 2 pc: 219", "ADD_IMM_32 (131) operands: 68, 255 pc: 224",
    "BRANCH_NE (171) operands: 75, 86, 2 pc: 227", "LOAD_IMM (51) operands: 5, 11 pc: 231",
    "LOAD_IMM (51) operands: 10, 0, 0, 0, 128 pc: 234", "ADD_IMM_32 (131) operands: 170, 255 pc: 240",
    "SHAR_R_IMM_32 (140) operands: 171, 31 pc: 243", "LOAD_IMM (51) operands: 4 pc: 246",
    "BRANCH_NE (171) operands: 75, 65, 2 pc: 248", "LOAD_IMM (51) operands: 5, 12 pc: 252",
    "LOAD_IMM (51) operands: 10, 0, 128, 129, 129 pc: 255", "ADD_IMM_32 (131) operands: 170, 129, 1 pc: 261",
    "SHAR_R_IMM_32 (140) operands: 171 pc: 265", "LOAD_IMM (51) operands: 4, 0, 128, 129, 129 pc: 267",
    "ADD_IMM_32 (131) operands: 68, 129, 1 pc: 273", "BRANCH_NE (171) operands: 75, 36, 2 pc: 277",
    "LOAD_IMM (51) operands: 5, 13 pc: 281", "LOAD_IMM (51) operands: 10, 0, 128, 129, 129 pc: 284",
    "ADD_IMM_32 (131) operands: 170, 129, 1 pc: 290", "SHAR_R_IMM_32 (140) operands: 171, 1 pc: 294",
    "LOAD_IMM (51) operands: 4, 0, 192, 192, 192 pc: 297", "ADD_IMM_32 (131) operands: 68, 192, 0 pc: 303",
    "BRANCH_NE (171) operands: 75, 6, 2 pc: 307", "LOAD_IMM (51) operands: 5, 14 pc: 311",
    "LOAD_IMM (51) operands: 10, 0, 128, 129, 129 pc: 314", "ADD_IMM_32 (131) operands: 170, 129, 1 pc: 320",
    "SHAR_R_IMM_32 (140) operands: 171, 7 pc: 324", "LOAD_IMM (51) operands: 4, 0, 0, 3, 255 pc: 327",
    "ADD_IMM_32 (131) operands: 68, 3, 3 pc: 333", "BRANCH_NE (171) operands: 75, 232, 1 pc: 337",
    "LOAD_IMM (51) operands: 5, 15 pc: 341", "LOAD_IMM (51) operands: 10, 0, 128, 129, 129 pc: 344",
    "ADD_IMM_32 (131) operands: 170, 129, 1 pc: 350", "SHAR_R_IMM_32 (140) operands: 171, 14 pc: 354",
    "LOAD_IMM (51) operands: 4, 0, 0, 254 pc: 357", "ADD_IMM_32 (131) operands: 68, 6, 6 pc: 362",
    "BRANCH_NE (171) operands: 75, 203, 1 pc: 366", "LOAD_IMM (51) operands: 5, 16 pc: 370",
    "LOAD_IMM (51) operands: 10, 0, 128, 129, 129 pc: 373", "ADD_IMM_32 (131) operands: 170, 129, 1 pc: 379",
    "SHAR_R_IMM_32 (140) operands: 171, 31 pc: 383", "LOAD_IMM (51) operands: 4, 255 pc: 386",
    "BRANCH_NE (171) operands: 75, 180, 1 pc: 389", "LOAD_IMM (51) operands: 5, 44 pc: 393",
    "LOAD_IMM (51) operands: 10, 0, 32, 241 pc: 396",
    ... 143 more items
  ],
}
[2025-10-25T13:51:29.447Z] [INFO] jumpTable: {
  jumpTable: [],
}
[2025-10-25T13:51:29.447Z] [INFO] bitmask: {
  bitmask: Uint8Array(845) [ 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, ... 332 more ],
}
LOAD_IMM Executing {
  registerA: 5,
  immediateX: 2n,
  pc: 13n,
  operands: [ 5, 2 ],
  fskip: 2,
  registers: [
    0n, 0n, 0n, 0n, 0n, 2n, 0n, 0n, 0n, 0n, 0n, 0n, 0n
  ],
}
PVM.run: Result code {
  resultCode: null,
  gas: "9999",
  pc: "16",
}
LOAD_IMM Executing {
  registerA: 10,
  immediateX: 18446744071562067968n,
  pc: 16n,
  operands: [ 10, 0, 0, 0, 128 ],
  fskip: 5,
  registers: [
    0n, 0n, 0n, 0n, 0n, 2n, 0n, 0n, 0n, 0n, 18446744071562067968n, 0n, 0n
  ],
}
PVM.run: Result code {
  resultCode: null,
  gas: "9998",
  pc: "22",
}
[2025-10-25T13:51:29.448Z] [DEBUG] Executing SHAR_R_IMM_32 instruction {
  registerA: 11,
  registerB: 10,
  immediateX: 0n,
  registerValue: 2147483648n,
  signedValue: 18446744071562067968n,
  shiftAmount: 0n,
  shifted: 18446744071562067968n,
  result: 36893488140976652288n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9997",
  pc: "24",
}
LOAD_IMM Executing {
  registerA: 4,
  immediateX: 18446744071562067968n,
  pc: 24n,
  operands: [ 4, 0, 0, 0, 128 ],
  fskip: 5,
  registers: [
    0n, 0n, 0n, 0n, 18446744071562067968n, 2n, 0n, 0n, 0n, 0n, 18446744071562067968n, 18446744067267100672n,
    0n
  ],
}
PVM.run: Result code {
  resultCode: null,
  gas: "9996",
  pc: "30",
}
Executing BRANCH_NE instruction {
  operands: [ 75, 27, 3 ],
  currentPC: 30n,
  registerA: 11,
  registerB: 4,
  registerValueA: 18446744067267100672n,
  registerValueB: 18446744071562067968n,
  targetAddress: 825n,
}
[2025-10-25T13:51:29.448Z] [DEBUG] BRANCH_NE: Branching to valid basic block start {
  targetAddress: 825n,
  currentPC: 30n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9995",
  pc: "825",
}
[2025-10-25T13:51:29.448Z] [DEBUG] Executing TRAP instruction
PVM.run: Result code {
  resultCode: 1,
  gas: "9994",
  pc: "825",
}
❌ Test failed: riscv_rv64ui_sraiw {
  expected: "4294901760 at register 0",
  actual: "0 at register 0",
}
❌ Test failed: riscv_rv64ui_sraiw 61 |           if(result.registers[j] !== BigInt(testVector['expected-regs'][j])) {
62 |               console.error(`❌ Test failed: ${testVector.name}`, {
63 |                   expected: `${testVector['expected-regs'][j]} at register ${j}`,
64 |                   actual: `${result.registers[j]} at register ${j}`,
65 |               })
66 |               throw new Error(`Test failed: ${testVector.name}`)
                         ^
error: Test failed: riscv_rv64ui_sraiw
      at /Users/tanyageorgieva/Repos/peanutbutterandjam/packages/pvm/src/instructions/__tests__/riscv-programs.test.ts:66:21


# Unhandled error between tests
-------------------------------
61 |           if(result.registers[j] !== BigInt(testVector['expected-regs'][j])) {
62 |               console.error(`❌ Test failed: ${testVector.name}`, {
63 |                   expected: `${testVector['expected-regs'][j]} at register ${j}`,
64 |                   actual: `${result.registers[j]} at register ${j}`,
65 |               })
66 |               throw new Error(`Test failed: ${testVector.name}`)
                         ^
error: Test failed: riscv_rv64ui_sraiw
      at /Users/tanyageorgieva/Repos/peanutbutterandjam/packages/pvm/src/instructions/__tests__/riscv-programs.test.ts:66:21
-------------------------------


 0 pass
 1 fail
 1 error
Ran 1 test across 1 file. [130.00ms]
