bun test v1.2.21 (7c45ed97)

packages/pvm/src/instructions/__tests__/riscv-programs.test.ts:
Found 102 test vector files
Loaded test vector: riscv_rv64uzbb_cpopw.json
Loaded test vector: riscv_rv64ui_slli.json
Loaded test vector: riscv_rv64ui_sraiw.json
Loaded test vector: riscv_rv64uzbb_andn.json
Loaded test vector: riscv_rv64ui_subw.json
Loaded test vector: riscv_rv64ui_ori.json
Loaded test vector: riscv_rv64ui_bltu.json
Loaded test vector: riscv_rv64uzbb_sext_b.json
Loaded test vector: riscv_rv64ua_amomax_d.json
Loaded test vector: riscv_rv64um_mulw.json
Loaded test vector: riscv_rv64um_mul.json
Loaded test vector: riscv_rv64ui_lh.json
Loaded test vector: riscv_rv64um_mulhu.json
Loaded test vector: riscv_rv64ui_addi.json
Loaded test vector: riscv_rv64uzbb_ctzw.json
Loaded test vector: riscv_rv64ui_sltiu.json
Loaded test vector: riscv_rv64uzbb_minu.json
Loaded test vector: riscv_rv64ui_ld.json
Loaded test vector: riscv_rv64uzbb_clzw.json
Loaded test vector: riscv_rv64ui_srlw.json
Loaded test vector: riscv_rv64ui_bgeu.json
Loaded test vector: riscv_rv64ua_amomin_d.json
Loaded test vector: riscv_rv64um_div.json
Loaded test vector: riscv_rv64uzbb_roriw.json
Loaded test vector: riscv_rv64um_divuw.json
Loaded test vector: riscv_rv64ui_srli.json
Loaded test vector: riscv_rv64ui_xor.json
Loaded test vector: riscv_rv64ui_sb.json
Loaded test vector: riscv_rv64ui_slti.json
Loaded test vector: riscv_rv64um_rem.json
Loaded test vector: riscv_rv64ua_amomaxu_d.json
Loaded test vector: riscv_rv64ui_lhu.json
Loaded test vector: riscv_rv64ui_addw.json
Loaded test vector: riscv_rv64um_remw.json
Loaded test vector: riscv_rv64ui_beq.json
Loaded test vector: riscv_rv64ui_sw.json
Loaded test vector: riscv_rv64ui_lwu.json
Loaded test vector: riscv_rv64ua_amomin_w.json
Loaded test vector: riscv_rv64uzbb_sext_h.json
Loaded test vector: riscv_rv64um_mulh.json
Loaded test vector: riscv_rv64ui_lw.json
Loaded test vector: riscv_rv64ui_sllw.json
Loaded test vector: riscv_rv64ui_lb.json
Loaded test vector: riscv_rv64um_mulhsu.json
Loaded test vector: riscv_rv64ui_blt.json
Loaded test vector: riscv_rv64ui_bge.json
Loaded test vector: riscv_rv64ui_sub.json
Loaded test vector: riscv_rv64ui_and.json
Loaded test vector: riscv_rv64ui_andi.json
Loaded test vector: riscv_rv64ua_amomax_w.json
Loaded test vector: riscv_rv64ui_lbu.json
Loaded test vector: riscv_rv64ui_srliw.json
Loaded test vector: riscv_rv64ua_amoxor_w.json
Loaded test vector: riscv_rv64uc_rvc.json
Loaded test vector: riscv_rv64ui_ma_data.json
Loaded test vector: riscv_rv64ua_amoand_d.json
Loaded test vector: riscv_rv64ui_or.json
Loaded test vector: riscv_rv64ui_jal.json
Loaded test vector: riscv_rv64uzbb_clz.json
Loaded test vector: riscv_rv64um_remu.json
Loaded test vector: riscv_rv64ua_amoor_w.json
Loaded test vector: riscv_rv64ui_slt.json
Loaded test vector: riscv_rv64ua_amoadd_w.json
Loaded test vector: riscv_rv64ui_sraw.json
Loaded test vector: riscv_rv64um_remuw.json
Loaded test vector: riscv_rv64uzbb_rorw.json
Loaded test vector: riscv_rv64uzbb_orc_b.json
Loaded test vector: riscv_rv64ui_add.json
Loaded test vector: riscv_rv64ui_xori.json
Loaded test vector: riscv_rv64ua_amominu_d.json
Loaded test vector: riscv_rv64ui_sll.json
Loaded test vector: riscv_rv64ua_amoswap_w.json
Loaded test vector: riscv_rv64uzbb_ror.json
Loaded test vector: riscv_rv64ui_jalr.json
Loaded test vector: riscv_rv64ui_lui.json
Loaded test vector: riscv_rv64uzbb_xnor.json
Loaded test vector: riscv_rv64uzbb_rol.json
Loaded test vector: riscv_rv64um_divu.json
Loaded test vector: riscv_rv64uzbb_ctz.json
Loaded test vector: riscv_rv64ua_amoadd_d.json
Loaded test vector: riscv_rv64uzbb_rev8.json
Loaded test vector: riscv_rv64ua_amoor_d.json
Loaded test vector: riscv_rv64uzbb_zext_h.json
Loaded test vector: riscv_rv64uzbb_cpop.json
Loaded test vector: riscv_rv64uzbb_orn.json
Loaded test vector: riscv_rv64ua_amoand_w.json
Loaded test vector: riscv_rv64uzbb_max.json
Loaded test vector: riscv_rv64ua_amoxor_d.json
Loaded test vector: riscv_rv64ui_srl.json
Loaded test vector: riscv_rv64ui_bne.json
Loaded test vector: riscv_rv64uzbb_min.json
Loaded test vector: riscv_rv64ui_srai.json
Loaded test vector: riscv_rv64ua_amoswap_d.json
Loaded test vector: riscv_rv64uzbb_rori.json
Loaded test vector: riscv_rv64ui_sltu.json
Loaded test vector: riscv_rv64ui_sra.json
Loaded test vector: riscv_rv64ua_amominu_w.json
Loaded test vector: riscv_rv64ui_simple.json
Loaded test vector: riscv_rv64ui_addiw.json
Loaded test vector: riscv_rv64ui_slliw.json
Loaded test vector: riscv_rv64uzbb_rolw.json
Loaded test vector: riscv_rv64uzbb_maxu.json
Successfully loaded 102 test vectors
[2025-10-25T11:28:08.482Z] [INFO] instructions: {
  instructions: [
    "LOAD_IMM (51) operands: 0, 0, 0, 1 pc: 0", "ADD_IMM_32 (131) operands: 0, 255 pc: 5",
    "SHLO_L_IMM_64 (151) operands: 0, 16 pc: 8", "JUMP_IND (50) operands: 0 pc: 11", "LOAD_IMM (51) operands: 5, 2 pc: 13",
    "LOAD_IMM (51) operands: 0 pc: 16", "COUNT_SET_BITS_32 (103) operands: 11 pc: 18",
    "LOAD_IMM (51) operands: 4 pc: 20", "BRANCH_NE (171) operands: 75, 217, 1 pc: 22",
    "LOAD_IMM (51) operands: 5, 3 pc: 26", "LOAD_IMM (51) operands: 0, 1 pc: 29", "COUNT_SET_BITS_32 (103) operands: 11 pc: 32",
    "LOAD_IMM (51) operands: 4, 1 pc: 34", "BRANCH_NE (171) operands: 75, 202, 1 pc: 37",
    "LOAD_IMM (51) operands: 5, 4 pc: 41", "LOAD_IMM (51) operands: 0, 3 pc: 44", "COUNT_SET_BITS_32 (103) operands: 11 pc: 47",
    "LOAD_IMM (51) operands: 4, 2 pc: 49", "BRANCH_NE (171) operands: 75, 187, 1 pc: 52",
    "LOAD_IMM (51) operands: 5, 5 pc: 56", "LOAD_IMM (51) operands: 0, 0, 0, 2 pc: 59",
    "ADD_IMM_32 (131) operands: 0, 255 pc: 64", "SHLO_L_IMM_64 (151) operands: 0, 15 pc: 67",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 70", "LOAD_IMM (51) operands: 4, 17 pc: 72",
    "BRANCH_NE (171) operands: 75, 164, 1 pc: 75", "LOAD_IMM (51) operands: 5, 6 pc: 79",
    "LOAD_IMM (51) operands: 0, 0, 0, 128, 0 pc: 82", "COUNT_SET_BITS_32 (103) operands: 11 pc: 88",
    "LOAD_IMM (51) operands: 4, 1 pc: 90", "BRANCH_NE (171) operands: 75, 146, 1 pc: 93",
    "LOAD_IMM (51) operands: 5, 7 pc: 97", "LOAD_IMM (51) operands: 0, 0, 0, 8 pc: 100",
    "ADD_IMM_32 (131) operands: 0, 251 pc: 105", "SHLO_L_IMM_64 (151) operands: 0, 13 pc: 108",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 111", "LOAD_IMM (51) operands: 4, 18 pc: 113",
    "BRANCH_NE (171) operands: 75, 123, 1 pc: 116", "LOAD_IMM (51) operands: 5, 8 pc: 120",
    "LOAD_IMM (51) operands: 0, 0, 128, 0 pc: 123", "ADD_IMM_32 (131) operands: 0, 255 pc: 128",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 131", "LOAD_IMM (51) operands: 4, 15 pc: 133",
    "BRANCH_NE (171) operands: 75, 103, 1 pc: 136", "LOAD_IMM (51) operands: 5, 9 pc: 140",
    "LOAD_IMM (51) operands: 0, 0, 0, 0, 128 pc: 143", "ADD_IMM_32 (131) operands: 0, 255 pc: 149",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 152", "LOAD_IMM (51) operands: 4, 31 pc: 154",
    "BRANCH_NE (171) operands: 75, 82, 1 pc: 157", "LOAD_IMM (51) operands: 5, 10 pc: 161",
    "LOAD_IMM (51) operands: 0, 0, 0, 8 pc: 164", "ADD_IMM_32 (131) operands: 0, 255 pc: 169",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 172", "LOAD_IMM (51) operands: 4, 19 pc: 174",
    "BRANCH_NE (171) operands: 75, 62, 1 pc: 177", "LOAD_IMM (51) operands: 5, 11 pc: 181",
    "LOAD_IMM (51) operands: 0, 1 pc: 184", "SHLO_L_IMM_64 (151) operands: 0, 31 pc: 187",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 190", "LOAD_IMM (51) operands: 4, 1 pc: 192",
    "BRANCH_NE (171) operands: 75, 44, 1 pc: 195", "LOAD_IMM (51) operands: 5, 12 pc: 199",
    "LOAD_IMM (51) operands: 0, 0, 80, 31, 18 pc: 202", "COUNT_SET_BITS_32 (103) operands: 11 pc: 208",
    "LOAD_IMM (51) operands: 4, 9 pc: 210", "BRANCH_NE (171) operands: 75, 26, 1 pc: 213",
    "LOAD_IMM (51) operands: 5, 13 pc: 217", "LOAD_IMM (51) operands: 0 pc: 220", "COUNT_SET_BITS_32 (103) operands: 11 pc: 222",
    "LOAD_IMM (51) operands: 4 pc: 224", "BRANCH_NE (171) operands: 75, 13, 1 pc: 226",
    "LOAD_IMM (51) operands: 5, 14 pc: 230", "LOAD_IMM (51) operands: 0, 14 pc: 233",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 236", "LOAD_IMM (51) operands: 4, 3 pc: 238",
    "BRANCH_NE (171) operands: 75, 254, 0 pc: 241", "LOAD_IMM (51) operands: 5, 15 pc: 245",
    "LOAD_IMM (51) operands: 0, 0, 16, 64, 32 pc: 248", "ADD_IMM_32 (131) operands: 0, 65, 3 pc: 254",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 258", "LOAD_IMM (51) operands: 4, 7 pc: 260",
    "BRANCH_NE (171) operands: 75, 232, 0 pc: 263", "LOAD_IMM (51) operands: 5, 16 pc: 267",
    "LOAD_IMM (51) operands: 0, 13 pc: 270", "COUNT_SET_BITS_32 (103) operands: 0 pc: 273",
    "LOAD_IMM (51) operands: 4, 3 pc: 275", "BRANCH_NE (171) operands: 64, 217, 0 pc: 278",
    "LOAD_IMM (51) operands: 5, 17 pc: 282", "LOAD_IMM (51) operands: 0, 11 pc: 285",
    "COUNT_SET_BITS_32 (103) operands: 0 pc: 288", "LOAD_IMM (51) operands: 4, 3 pc: 290",
    "BRANCH_NE (171) operands: 64, 202, 0 pc: 293", "LOAD_IMM (51) operands: 5, 18 pc: 297",
    "LOAD_IMM (51) operands: 10 pc: 300", "FALLTHROUGH (1) operands:  pc: 302", "LOAD_IMM (51) operands: 0, 13 pc: 303",
    "COUNT_SET_BITS_32 (103) operands: 11 pc: 306", "MOVE_REG (100) operands: 179 pc: 308",
    "ADD_IMM_64 (149) operands: 170, 1 pc: 310",
    ... 78 more items
  ],
}
[2025-10-25T11:28:08.483Z] [INFO] jumpTable: {
  jumpTable: [],
}
[2025-10-25T11:28:08.483Z] [INFO] bitmask: {
  bitmask: Uint8Array(515) [ 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ... 2 more ],
}
LOAD_IMM: Parsed values {
  registerA: 5,
  immediateX: 2n,
}
LOAD_IMM: After setting register {
  registerA: 5,
  immediateX: 2n,
  registerValue: 2n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9999",
  pc: "16",
}
LOAD_IMM: Parsed values {
  registerA: 0,
  immediateX: 0n,
}
LOAD_IMM: After setting register {
  registerA: 0,
  immediateX: 0n,
  registerValue: 0n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9998",
  pc: "18",
}
[2025-10-25T11:28:08.483Z] [DEBUG] Executing COUNT_SET_BITS_32 instruction {
  registerB: 0,
  registerA: 11,
  value: 0n,
  count: 0n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9997",
  pc: "20",
}
LOAD_IMM: Parsed values {
  registerA: 4,
  immediateX: 0n,
}
LOAD_IMM: After setting register {
  registerA: 4,
  immediateX: 0n,
  registerValue: 0n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9996",
  pc: "22",
}
[2025-10-25T11:28:08.483Z] [DEBUG] Executing BRANCH_NE instruction {
  operands: [ 75, 217, 1 ],
  currentPC: 22n,
  registerA: 11,
  registerB: 4,
  registerValueA: 0n,
  registerValueB: 0n,
  targetAddress: 495n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9995",
  pc: "26",
}
LOAD_IMM: Parsed values {
  registerA: 5,
  immediateX: 3n,
}
LOAD_IMM: After setting register {
  registerA: 5,
  immediateX: 3n,
  registerValue: 3n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9994",
  pc: "29",
}
LOAD_IMM: Parsed values {
  registerA: 0,
  immediateX: 1n,
}
LOAD_IMM: After setting register {
  registerA: 0,
  immediateX: 1n,
  registerValue: 1n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9993",
  pc: "32",
}
[2025-10-25T11:28:08.483Z] [DEBUG] Executing COUNT_SET_BITS_32 instruction {
  registerB: 0,
  registerA: 11,
  value: 0n,
  count: 0n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9992",
  pc: "34",
}
LOAD_IMM: Parsed values {
  registerA: 4,
  immediateX: 1n,
}
LOAD_IMM: After setting register {
  registerA: 4,
  immediateX: 1n,
  registerValue: 1n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9991",
  pc: "37",
}
[2025-10-25T11:28:08.483Z] [DEBUG] Executing BRANCH_NE instruction {
  operands: [ 75, 202, 1 ],
  currentPC: 37n,
  registerA: 11,
  registerB: 4,
  registerValueA: 0n,
  registerValueB: 1n,
  targetAddress: 495n,
}
[2025-10-25T11:28:08.484Z] [DEBUG] BRANCH_NE: Branching to valid basic block start {
  targetAddress: 495n,
  currentPC: 37n,
}
PVM.run: Result code {
  resultCode: null,
  gas: "9990",
  pc: "495",
}
[2025-10-25T11:28:08.484Z] [DEBUG] Executing TRAP instruction
PVM.run: Result code {
  resultCode: 1,
  gas: "9989",
  pc: "495",
}
❌ Test failed: riscv_rv64uzbb_cpopw {
  expected: "4294901760 at register 0",
  actual: "0 at register 0",
}
❌ Test failed: riscv_rv64uzbb_cpopw 58 |           if(result.registers[j] !== BigInt(testVector['expected-regs'][j])) {
59 |               console.error(`❌ Test failed: ${testVector.name}`, {
60 |                   expected: `${testVector['expected-regs'][j]} at register ${j}`,
61 |                   actual: `${result.registers[j]} at register ${j}`,
62 |               })
63 |               throw new Error(`Test failed: ${testVector.name}`)
                         ^
error: Test failed: riscv_rv64uzbb_cpopw
      at /Users/tanyageorgieva/Repos/peanutbutterandjam/packages/pvm/src/instructions/__tests__/riscv-programs.test.ts:63:21


# Unhandled error between tests
-------------------------------
58 |           if(result.registers[j] !== BigInt(testVector['expected-regs'][j])) {
59 |               console.error(`❌ Test failed: ${testVector.name}`, {
60 |                   expected: `${testVector['expected-regs'][j]} at register ${j}`,
61 |                   actual: `${result.registers[j]} at register ${j}`,
62 |               })
63 |               throw new Error(`Test failed: ${testVector.name}`)
                         ^
error: Test failed: riscv_rv64uzbb_cpopw
      at /Users/tanyageorgieva/Repos/peanutbutterandjam/packages/pvm/src/instructions/__tests__/riscv-programs.test.ts:63:21
-------------------------------


 0 pass
 1 fail
 1 error
Ran 1 test across 1 file. [231.00ms]
