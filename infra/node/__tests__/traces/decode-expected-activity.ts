/**
 * Decode Expected Activity Statistics
 * 
 * Decodes the expected activity hex from the test failure to see its structure
 */

import { hexToBytes } from '@pbnj/core'
import { decodeActivity } from '@pbnj/codec'
import { ConfigService } from '../../services/config-service'

const expectedHex = '0x010000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000810e9f1d000000000000000001000000000000019f1d000000000000'

const configService = new ConfigService('tiny')

// Convert hex to bytes
const expectedBytes = hexToBytes(expectedHex)

// Decode activity
const [error, result] = decodeActivity(expectedBytes, configService)

if (error) {
  console.error('Error decoding activity:', error.message)
  process.exit(1)
}

// Print JSON with bigint serialization
console.log(JSON.stringify(result.value, (_, v) =>
  typeof v === 'bigint' ? v.toString() : v === undefined ? null : v,
  2
))

